{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
    />
    <title></title>
    <!--<link rel="stylesheet" href="{% static 'css/reviews.css' %}" />-->
  </head>
  <body>
    <header style="margin-bottom: 100px">
      <a href="/" class="logo">My SW Idea Manage</a>
      <a href="/register">아이디어 등록</a>
      <a href="/">아이디어 관리</a>
      <a href="/tool/register">개발툴 등록</a>
      <a href="/tool">개발툴 관리</a>
    </header>
    <div class="main">
      <div class="ideas" style="display: flex">
        {% for idea in ideas %}
        <article style="margin: 100px 20px">
          <button id="{{idea.id}}" onclick="idea_like(this.id)">
            {%if request.user in idea.like.all%}
            <!-- 로그인 한 유저가 좋아요를 누른 유저일때  -->
            <i id="heart{{idea.id}}" class="fas fa-heart"></i>
            {%else%}
            <!-- 로그인 한 유저가 좋아요를 누른 유저가 아닐 때  -->
            <i id="heart{{idea.id}}" class="far fa-heart"></i>
            {%endif%}
          </button>
          {% if idea.image %}
          <div>
            <img src="{{idea.image.url}}" style="width: 300px; height: 300px" />
          </div>
          {% endif %}
          <div class="content">
            <div class="name">
              <a href="/detail/{{idea.id}}">{{idea.name}}</a>
            </div>
            <div class="summary">
              <div class="tool">
                <span class="property">예상 개발 툴 : </span>
                <span>{{idea.tool}}</span>
              </div>
              <div class="interest">
                <span class="property">아이디어 관심도 : </span>
                <span>{{idea.interest}}</span>
              </div>
            </div>
          </div>
        </article>
        {% endfor %}
      </div>
    </div>
    <div class="toast" style="display: none">
      <div id="message"></div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript">
      function idea_like(id) {
        $.ajax({
          url: "like", // data를 전송할 url 입니다.
          data: {
            idea_id: id,
          }, // post_id 라는 name으로 id 값 전송
          dataType: "json",
          success: function (response) {
            // ajax 통신이 정상적으로 완료되었을 때
            $("#like_count").html(response.like_count); //id가 like_count의 내용을 전송받은 좋아요 수로 바꾼다
            $("#message").html(response.message); //id가 message의 내용을 전송받은 message로 바꾼다
            $(".toast").fadeIn(400).delay(100).fadeOut(400);
            if (response.message == "좋아요") {
              //좋아요 눌렀을 때
              $("#heart" + id).attr("class", "fas fa-heart");
            } else if (response.message == "좋아요 취소") {
              //좋아요 상태에서 다시 눌렀을 때
              $("#heart" + id).attr("class", "far fa-heart");
            }
          },
        });
      }
    </script>
  </body>
</html>
