{% load static %}
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://kit.fontawesome.com/f578b19b63.js"
      crossorigin="anonymous"
    ></script>
    <title></title>
    <!--<link rel="stylesheet" href="{% static 'css/reviews.css' %}" />-->
  </head>
  <body>
    <header>
      <a href="/" class="logo">My SW Idea Manage</a>
      <a href="/register">아이디어 등록</a>
      <a href="/">아이디어 관리</a>
      <a href="/tool/register">개발툴 등록</a>
      <a href="/tool">개발툴 관리</a>
    </header>
    <div class="main">
      <div class="ideas">
        {% for idea in ideas %}
        <article>
          <div>
            <input
              type="button"
              class="like"
              name="{{ idea.id }}"
              value="Like"
            />
            <p id="count-{{ idea.id }}">
              좋아요&nbsp;{{ idea.likes_user.all.count }}개
            </p>
          </div>
          {% if idea.image %}
          <div>
            <img src="{{idea.image.url}}" />
          </div>
          {% endif %}
          <div class="content">
            <div class="name">
              <a href="/detail/{{idea.id}}">{{idea.name}}</a>
            </div>
            <div class="summary">
              <div class="tool">
                <span class="property">예상 개발 툴 : </span>
                <span>{{idea.tool}}</span>
              </div>
              <div class="interest">
                <span class="property">아이디어 관심도 : </span>
                <span>{{idea.interest}}</span>
              </div>
            </div>
          </div>
        </article>
        {% endfor %}
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript">
      $(".like").click(function () {
        // .like 버튼을 클릭 감지
        var pk = $(this).attr("name");
        $.ajax({
          // ajax로 서버와 통신
          type: "POST", // 데이터를 전송하는 방법
          url: "like", // 통신할 url을 지정
          data: { pk: pk, csrfmiddlewaretoken: "{{ csrf_token }}" }, // 서버로 데이터 전송시 옵션, pk를 넘겨야 어떤 video인지 알 수 있음
          dataType: "json",
          success: function (response) {
            // 성공
            alert(response.message);
            $("#count-" + pk).html(
              "좋아요&nbsp;" + response.likes_count + "개"
            ); // 좋아요 개수 변경
          },
          error: function (request, status, error) {
            // 실패
            alert("로그인이 필요합니다.");
            window.location.replace("admin/login/"); // 로그인 페이지로 넘어가기
          },
        });
      });
    </script>
  </body>
</html>
